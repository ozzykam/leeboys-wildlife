<div class="min-h-[80vh] flex items-center justify-center px-4">
  <div class="card w-full max-w-lg">
    
    <!-- Progress Steps -->
    <div class="flex justify-center mb-8">
      <div class="flex items-center space-x-4">
        <!-- Step 1: Find Account -->
        <div class="flex items-center">
          <div [class]="step === 'find-account' ? 'w-8 h-8 rounded-full bg-brand-primary text-white flex items-center justify-center text-sm font-medium' : step === 'verify-dob' || step === 'create-password' ? 'w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center text-sm font-medium' : 'w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-medium'">
            {{ step === 'verify-dob' || step === 'create-password' ? '✓' : '1' }}
          </div>
          <span class="ml-2 text-sm font-medium" [class]="step === 'find-account' ? 'text-brand-primary' : step === 'verify-dob' || step === 'create-password' ? 'text-green-600' : 'text-gray-500'">Find Account</span>
        </div>
        
        <!-- Connector -->
        <div class="w-8 h-0.5" [class]="step === 'verify-dob' || step === 'create-password' ? 'bg-green-500' : 'bg-gray-300'"></div>
        
        <!-- Step 2: Verify DOB -->
        <div class="flex items-center">
          <div [class]="step === 'verify-dob' ? 'w-8 h-8 rounded-full bg-brand-primary text-white flex items-center justify-center text-sm font-medium' : step === 'create-password' ? 'w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center text-sm font-medium' : 'w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-medium'">
            {{ step === 'create-password' ? '✓' : '2' }}
          </div>
          <span class="ml-2 text-sm font-medium" [class]="step === 'verify-dob' ? 'text-brand-primary' : step === 'create-password' ? 'text-green-600' : 'text-gray-500'">Verify Identity</span>
        </div>
        
        <!-- Connector -->
        <div class="w-8 h-0.5" [class]="step === 'create-password' ? 'bg-green-500' : 'bg-gray-300'"></div>
        
        <!-- Step 3: Create Password -->
        <div class="flex items-center">
          <div [class]="step === 'create-password' ? 'w-8 h-8 rounded-full bg-brand-primary text-white flex items-center justify-center text-sm font-medium' : 'w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-medium'">
            3
          </div>
          <span class="ml-2 text-sm font-medium" [class]="step === 'create-password' ? 'text-brand-primary' : 'text-gray-500'">Create Password</span>
        </div>
      </div>
    </div>

    <!-- Step 1: Find Account -->
    <div *ngIf="step === 'find-account'">
      <div class="text-center mb-8">
        <h1 class="h1 mb-2">Find Your Account</h1>
        <p class="text-gray-600">Enter your billing account number to get started</p>
      </div>

      <form (ngSubmit)="onFindAccount()" #findForm="ngForm" class="space-y-6">
        <!-- Billing Account Number -->
        <div>
          <label for="billingAccountNumber" class="block text-sm font-medium text-gray-700 mb-1">
            Billing Account Number *
          </label>
          <input
            type="text"
            id="billingAccountNumber"
            name="billingAccountNumber"
            [(ngModel)]="billingAccountNumber"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
            placeholder="Enter your billing account number"
          >
          <p class="text-sm text-gray-500 mt-1">
            This was provided in your activation email from LeeBoy's Wildlife Removal
          </p>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-red-600 text-sm">{{ errorMessage }}</p>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="p-3 bg-green-50 border border-green-200 rounded-lg">
          <p class="text-green-600 text-sm">{{ successMessage }}</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="text-center">
          <p class="text-gray-600">Finding your account...</p>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          [disabled]="!findForm.form.valid || loading"
          class="w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ loading ? 'Finding Account...' : 'Find Account' }}
        </button>
      </form>
    </div>

    <!-- Step 2: Verify Date of Birth -->
    <div *ngIf="step === 'verify-dob'">
      <div class="text-center mb-8">
        <h1 class="h1 mb-2">Verify Your Identity</h1>
        <p class="text-gray-600">Please enter your date of birth to verify your identity</p>
      </div>

      <!-- Account Info -->
      <div *ngIf="pendingAccountData" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
        <h4 class="font-semibold text-green-900 mb-2">Account Found</h4>
        <div class="text-sm text-green-800 space-y-1">
          <p><strong>Name:</strong> {{ pendingAccountData.firstName }} {{ pendingAccountData.lastName }}</p>
          <p><strong>Email:</strong> {{ pendingAccountData.email }}</p>
          <p><strong>Billing Account:</strong> {{ billingAccountNumber }}</p>
          <p><strong>DOB</strong>{{pendingAccountData.dateOfBirth}}</p>
        </div>
      </div>

      <form (ngSubmit)="onVerifyDateOfBirth()" #dobForm="ngForm" class="space-y-6">
        <!-- Date of Birth -->
        <div>
          <label for="dateOfBirth" class="block text-sm font-medium text-gray-700 mb-1">
            Date of Birth *
          </label>
          <input
            type="date"
            id="dateOfBirth"
            name="dateOfBirth"
            [(ngModel)]="dateOfBirth"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
          >
          <p class="text-sm text-gray-500 mt-1">
            Enter the date of birth associated with this account
          </p>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-red-600 text-sm">{{ errorMessage }}</p>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="p-3 bg-green-50 border border-green-200 rounded-lg">
          <p class="text-green-600 text-sm">{{ successMessage }}</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="text-center">
          <p class="text-gray-600">Verifying date of birth...</p>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4">
          <button
            type="button"
            (click)="goBackToFindAccount()"
            class="flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Back
          </button>
          <button
            type="submit"
            [disabled]="!dobForm.form.valid || loading"
            class="flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {{ loading ? 'Verifying...' : 'Verify Identity' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Step 3: Create Password -->
    <div *ngIf="step === 'create-password'">
      <div class="text-center mb-8">
        <h1 class="h1 mb-2">Create Your Password</h1>
        <p class="text-gray-600">Set up your login credentials to complete activation</p>
      </div>

      <!-- Account Info -->
      <div *ngIf="pendingAccountData" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
        <h4 class="font-semibold text-green-900 mb-2">Account Verified</h4>
        <div class="text-sm text-green-800 space-y-1">
          <p><strong>Name:</strong> {{ pendingAccountData.firstName }} {{ pendingAccountData.lastName }}</p>
          <p><strong>Email:</strong> {{ pendingAccountData.email }}</p>
          <p><strong>Billing Account:</strong> {{ billingAccountNumber }}</p>
        </div>
      </div>

      <form (ngSubmit)="onActivateAccount()" #activateForm="ngForm" class="space-y-6">
        <!-- Email (auto-populated, editable) -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
            Email Address (Login Username) *
          </label>
          <input
            type="email"
            id="email"
            name="email"
            [(ngModel)]="email"
            required
            email
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
            placeholder="Enter your email address"
          >
          <p class="text-sm text-gray-500 mt-1">
            This will be your username for logging in. You can change it later in your account settings.
          </p>
        </div>

        <!-- Password -->
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
            Create Password *
          </label>
          <input
            type="password"
            id="password"
            name="password"
            [(ngModel)]="password"
            required
            minlength="6"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
            placeholder="Create a secure password (min 6 characters)"
          >
        </div>

        <!-- Confirm Password -->
        <div>
          <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">
            Confirm Password *
          </label>
          <input
            type="password"
            id="confirmPassword"
            name="confirmPassword"
            [(ngModel)]="confirmPassword"
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-primary focus:border-transparent"
            placeholder="Confirm your password"
          >
          <div *ngIf="password && confirmPassword && password !== confirmPassword" class="mt-1">
            <p class="text-red-600 text-sm">Passwords do not match</p>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="p-3 bg-red-50 border border-red-200 rounded-lg">
          <p class="text-red-600 text-sm">{{ errorMessage }}</p>
        </div>

        <!-- Success Message -->
        <div *ngIf="successMessage" class="p-3 bg-green-50 border border-green-200 rounded-lg">
          <p class="text-green-600 text-sm">{{ successMessage }}</p>
        </div>

        <!-- Loading State -->
        <div *ngIf="loading" class="text-center">
          <p class="text-gray-600">Activating your account...</p>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4">
          <button
            type="button"
            (click)="goBackToVerifyDOB()"
            class="flex-1 px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Back
          </button>
          <button
            type="submit"
            [disabled]="!activateForm.form.valid || loading || (password !== confirmPassword)"
            class="flex-1 btn-primary disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {{ loading ? 'Activating...' : 'Activate Account' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Footer Links -->
    <div class="text-center mt-6 pt-6 border-t border-gray-200">
      <p class="mb-2">
        Need help? Contact customer service for assistance.
      </p>
      <div class="text-gray-600 text-sm mb-2">
        Already have an active account? 
        <a routerLink="/login" class="text-brand-primary hover:text-brand-accent text-sm font-medium">
          Sign In
        </a>
        <span class="text-gray-300">|</span>
        <a routerLink="/" class="text-brand-primary hover:text-brand-accent text-sm font-medium">
          Return Home
        </a>
      </div>
    </div>
  </div>
</div>